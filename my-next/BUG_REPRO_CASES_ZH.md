# 工作區訂單異常：4 個可重現案例（中文整理）

本文將目前描述到的問題整理成 4 條主要重現路徑，方便開發與除錯。

## 共同前置條件
1. 開啟 `yoichi-react.onrender.com`。
2. 以 F12 開啟 DevTools，清除 Local Storage。
3. 重新整理（F5）後開始測試。

---

## 案例 1：不切換頁籤時流程正常

### 操作步驟
1. 在工作區新增商品並按「生成」建立訂單（可連續建立多筆，如 0 號、1 號）。
2. 點擊訂單卡的「按我」按鈕，開啟 popover。
3. 點擊「付款」，按鈕由紅色變綠色，顯示「已付」。
4. 再次點擊「已付」，於 popover 中執行「取消付款」。
5. 再新增商品並「生成」新訂單。

### 結果
- 不切換到其他頁籤（如會員專區、功能編輯區）時，建立訂單、付款、取消付款、再建立都正常。

---

## 案例 2：切換到功能編輯區再回工作區後，產生空白/0 元訂單與狀態錯亂

### 操作步驟
1. 清空 Local Storage 並 F5。
2. 建立一筆訂單（0 號）。
3. 切到「功能編輯區」，再回「工作區」。
4. 對 0 號訂單點「按我」→「付款」。
5. 再新增商品並按「生成」。

### 主要異常
- 新增出來的訂單會變成：
  - 沒有商品名稱、沒有數量。
  - 金額為 0 元。
- 這些異常訂單的「按我」按鈕常無法點擊（hover 有變色但 click 無效）。
- 若先對正常訂單（如 0 號）開啟「按我」並點「修改」（就算不改內容），異常訂單的按鈕可能又突然可點。
- 訂單卡片會出現「消失又出現」：
  - 某些單號暫時不見，之後又回來。
  - 單號顯示與實際新增結果不一致（例如畫面預期 3 號，實際新增成 4 號）。
- 重新整理（F5）後狀態通常會恢復較一致。

---

## 案例 3：切換到會員專區再回工作區，也會出現空白/0 元訂單

### 操作步驟
1. 清空 Local Storage 並 F5。
2. 先建立兩筆訂單。
3. 切換到「會員專區」後立即回「工作區」（不做其他輸入）。
4. 對 1 號訂單點「付款」。
5. 再新增任意商品並「生成」新訂單。

### 主要異常
- 新訂單可能變成空白內容、0 元（無商品名稱/數量/金額）。
- 後續再建的訂單也可能持續空白。
- F5 後，部分正常訂單可恢復顯示，但先前異常單（例如 2 號、3 號）仍可能維持空白/0 元。

### 補充觀察
- 若在會員專區執行「清除今日訂單」後回工作區，並搭配 F5，後續建立流程看起來較正常。

---

## 案例 4：清除今日訂單後，舊資料回灌（回跳）

### 操作步驟
1. 清空 Local Storage 並 F5。
2. 建立 3 筆訂單，並將其中部分訂單付款/完成。
3. 進入會員專區，執行「清除今日訂單」。
4. 回到工作區後再新增新訂單（如雞腿串、雞里香等），並嘗試付款。

### 主要異常
- 操作新訂單付款後，畫面可能突然回到「清除前」的舊訂單內容。
- 新建訂單可能出現空白、0 元。
- 單號可能延續但中間遺失（例如 2 號內容消失且難以再恢復）。
- 重新整理後，部分流程會變正常，但遺失單資料可能仍不回來。

---

## 初步判斷方向（供除錯）
- **跨頁籤狀態同步問題**：工作區、會員專區、功能編輯區之間可能使用了不同步或覆蓋式的狀態來源。
- **Local Storage 讀寫時機問題**：
  - 某些操作（付款、完成、清除今日訂單）後，狀態可能被舊快照覆蓋。
  - 重新整理可暫時修正，代表初始化流程與執行中狀態不一致。
- **訂單索引/ID 管理問題**：
  - 刪除、完成、清除後，單號映射與顯示清單不同步，導致單號跳號、重現、消失。
- **UI 互動綁定失效**：
  - 空白訂單「按我」不可點，可能是事件綁定依賴缺失資料或渲染 key 不穩定。
